---
title: "Preprocess Full VRI Files"
author: "Nicole Barker"
date: "Last run: Dec 20, 2017"
output: 
  word_document:
    reference_docx: ../styles/ReportFormat_1.docx
---

## Background

**FILES**

1. FORSITE_all_regions__Nicoles_VRI_fields_fixednames.csv
2. canfortflAttributeTable.txt

In this script, I: 

* Inspect each file independently for duplicates
* Merge 

``` {r setup, echo=F, message=F, warning=F}
require(knitr)
opts_knit$set(root.dir = '..')
```

``` {r load.project, message=F}
require(ProjectTemplate)
load.project()
options(digits=12)
```


## FORSITE_all_regions__Nicoles_VRI_fields_fixednames.csv

This is an export of the attribute table from "M:\DataStuff\SpatialData\VegetationResourceInventory\2016.10_Download\FORSITE_all_regions_all_vri_fields.gdb", dropped to the fields I wanted. 

The "fixednames" is because the table exported with incomplete field names. This was fixed in a previous iteration of analyses, so I don't need to repeat it now. 

``` {r}
forsite_vri <- read.csv("data/FORSITE_all_regions__Nicoles_VRI_fields_fixednames.csv", header=T)
forsite_colnames <- data.frame(ColName=colnames(forsite_vri), In_ForsiteVRI=as.character("Yes"))
```

#### Initial exploration to understand the format of the shapefile attribute table

* Number of unique objects in the polygon attribute table (OBJECTID): `r length(unique(forsite_vri$OBJECTID))`
* Number of unique polygons in the polygon attribute table (FEATURE_ID): `r length(unique(forsite_vri$FEATURE_ID))`
* Length of the attribute table (nrows): `r nrow(forsite_vri)`
* Number of unique forest stand types in the polygon attribute table (ForID): `r length(unique(forsite_vri$ForID))` 
* Number of rows in the polygon attribute table: `r nrow(forsite_vri)`
* Number of possible unique forest stand types based on combination of 4 attributes: `r length(unique(mastermatrix$ForID))`

**Conclusions:** 

* both OBJECTID and FEATURE_ID are unique identifiers for rows (polygons) in this file.
* No duplicates because same number of rows as unique polygon IDs. 

## canfortflAttributeTable.txt

``` {r}
canfortfl <- read.csv("data/canfortflAttributeTable.txt", header=T)
canfor_colnames <- data.frame(ColName=colnames(canfortfl), In_canfortfl=as.character("Yes"))
```

#### Initial exploration to understand the format of the shapefile attribute table

* Number of unique objects in the polygon attribute table (OBJECTID): `r length(unique(canfortfl$OBJECTID))`
* Length of the attribute table (nrows): `r nrow(canfortfl)`

``` {r}
all_colnames <- merge(canfor_colnames, forsite_colnames, by="ColName", all=T)

all_colnames$In_canfortfl <- as.character(all_colnames$In_canfortfl)
all_colnames$In_ForsiteVRI <- as.character(all_colnames$In_ForsiteVRI)

all_colnames$In_canfortfl[is.na(all_colnames$In_canfortfl)] <- ""
all_colnames$In_ForsiteVRI[is.na(all_colnames$In_ForsiteVRI)] <- ""

kable(all_colnames, row.names=F)
```

#### Add blank columns for those I need from the Forsite layer (i.e. derived fields)

``` {r}
canfortfl$BecZone <- NA                 
canfortfl$SpeciesGroup <- NA
canfortfl$Age <- NA
canfortfl$Height <- NA
canfortfl$Rank <- NA
canfortfl$FD_PERCENT <- NA
canfortfl$PL_PERCENT <- NA
canfortfl$AT_PERCENT <- NA
canfortfl$Decid_PERCENT <- NA
```

## Merge two VRI files together

#### Subset for common set of columns
``` {r}
commoncols <- all_colnames[all_colnames$In_canfortfl == "Yes" & all_colnames$In_ForsiteVRI == "Yes",]$ColName

canfortfl2 <- canfortfl[which(colnames(canfortfl) %in% commoncols)]
canfortfl2$VRI_Layer <- "Canfor_TFL"
forsite_vri2 <- forsite_vri[which(colnames(forsite_vri) %in% commoncols)]
forsite_vri2$VRI_Layer <- "Forsite_VRI"
```

#### rbind together

``` {r}
vri_full <- rbind(canfortfl2, forsite_vri2)
cache("vri_full")
```

